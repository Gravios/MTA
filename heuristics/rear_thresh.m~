function rear_state = rear_thresh(Session,varargin)
[rearThresh,display] = DefaultArgs(varargin,{44,0});

figure,plot(t,abs((Session.xyz(:,5,3)-Session.xyz(:,1,3)).*Session.ang(:,2,3,2).*Session.ang(:,3,4,2).*Session.ang(:,4,5,2)),'k') 
hold on, plot(t,(Session.xyz(:,5,3)-Session.xyz(:,1,3)),'r') 



hbpv = Session.xyz(:,Session.Model.gmi('head_back'),3)-Session.xyz(:,Session.Model.gmi('pelvis_root'),3);

rear = zeros(size(hbpv));
rear(hbpv>rearThresh)=1;
minInt = 50;
rearPeriods = ThreshCross(rear,0.5,minInt);

rear_state = zeros(size(rear));
for i = 1:size(rearPeriods,1)
    rear_state(rearPeriods(i,1):rearPeriods(i,2))=1;
end



if display,

    figure, hold on
    plot(hbpv)
    plot(rear_state*max(hbpv)/2+max(hbpv)/8,'r');

    figure,
    hist(hbpv,10000)

    figure,hold on
    plot(hbpv)
    plot(rear*100,'r')

end
