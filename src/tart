#! /bin/bash
cwd=$(pwd)

nCommits=4
message="update_mta: `date` "
gdir="/storage/share/matlab/MTA"


while [[ $# > 0 ]]
do
    key=$1
    case $key in
	-d|--git-directory)
	    gdir=$2
	    shift
	    ;;
	-m|--message)
	    message=$2
	    shift
	    ;;
	-n|--n-previous-commits)
	    n=$2
	    shift
	    ;;
	*)
	    ;;
    esac
    shift
done


if [ "$HOSTNAME" == "theta" -o "$HOSTNAME" == "gamma"* ]
then
    cd $gdir
    git commit -am "\"$message\""
    git push origin master
    git diff --name-only HEAD~0 HEAD~$nCommits | \
    tar cfz - -T - |                     \
    ssh $USERNAME_LRZ@lxlogin1.lrz.de    \
        "cd ~/matlab/MTA/;  tar xvfz -" 
#else    
#    cd ~/matlab/MTA
#    ssh $USER@10.153.170.1                    \
#	"cd /storage/share/matlab/MTA/;       \
#         git diff --name-only HEAD~1 HEAD~2 | \
#         tar cfz - -T - ./" |                 \
#    tar xvfz -
fi

cd $cwd
