#! /bin/bash
# tart - tar file transfer over ssh
# advantage over scp: copies relative links rather
# than following to hard copy
cwd=$(pwd)

hostname=$HOST_LRZ
file_list="./"
user=$USERNAME_LRZ

if [[ $# -eq 0 ]]
then
echo "tart [-h help] [-l login_name] [-T filelist] "
echo "     [-o remote_output_dir] [-p port] [[user@]hostname]"
fi

while [[ $# > 1 ]]
do
    key="$1"

    case $key in
        -h|--help)     
	    echo "tart [-l login_name] [-T filelist] [-o remote_output_dir]"
	    echo "     [-p port] [-u user] [[user@]hostname]"
	    exit 1
            ;;
	-l|--login-name)
	    login_name=$2
	    shift
	    ;;
        -o|--remote-output-dir)
            remote_output_dir=$2
            shift
            ;;
        -p|--port)
            port="-p $2"
            shift
	    ;;
	-T|--files-from)   
            file_list=$2
            shift
	    ;;
	-u|--user)
	    user=$2
            shift	    
	    ;;
	-v|--verbose)  
	    v="v"
            ;;
	*)            
            ;;
    esac
    shift 
done

if [[ $# -eq 1 ]]
then
  hostname=$1
fi

# check if user specifed output
#if [ hostname =~ ".*[:].+" ]
#then
#    remote_output_dir=''
#fi

tar c${v}fz - -T $file_list |  \
`ssh $port $user@$hostname -l $login_name  "cd ~/$remote_output_dir;  tar x${v}fz -"`

cd $cwd
