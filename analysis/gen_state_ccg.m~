function  Bccg = gen_state_ccg(Session,varargin)
[state,dur_thresh,trialName,mazeName] = DefaultArgs(varargin,{'rear',180,'all','cof'});

if ~isa(Session,'MTATrial')
    Session = MTATrial(Session,{},trialName,[],[],mazeName);
end

sper = Session.Bhv.getState(state).state;
sname = Session.Bhv.getState(state).label;


sdur = diff(sper,1,2);
sper = sper(sdur>dur_thresh,:);

Bccg = MTAccg(Session,sname,['CCG around' sname 'and offset'], ...
              {sper(:,1),sper(:,2)},{1,2},{[sname ' onset'],[sname ' offset']});